{"version":3,"file":"vnjson.js","sources":["../src/knot.js","../src/Vnjson.js","../src/plugins/log.js","../src/plugins/jump.js","../src/plugins/append.js","../src/plugins/timeout.js","../src/plugins/next.js","../src/vnjs.js"],"sourcesContent":["var _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar knot = function knot() {\n  var extended = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  var events = Object.create(null);\n\n  function on(name, handler) {\n    events[name] = events[name] || [];\n    events[name].push(handler);\n    return this;\n  }\n\n  function once(name, handler) {\n    handler._once = true;\n    on(name, handler);\n    return this;\n  }\n\n  function off(name) {\n    var handler = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n    handler ? events[name].splice(events[name].indexOf(handler), 1) : delete events[name];\n\n    return this;\n  }\n\n  function emit(name) {\n    var _this = this;\n\n    for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n\n    // cache the events, to avoid consequences of mutation\n    var cache = events[name] && events[name].slice();\n\n    // only fire handlers if they exist\n    cache && cache.forEach(function (handler) {\n      // remove handlers added with 'once'\n      handler._once && off(name, handler);\n\n      // set 'this' context, pass args to handlers\n      handler.apply(_this, args);\n    });\n\n    return this;\n  }\n\n  return _extends({}, extended, {\n\n    on: on,\n    once: once,\n    off: off,\n    emit: emit,\n    events: events\n  });\n};\n\nexport default knot;\n","import knot from \"./knot.js\";\r\n\r\nconst emitter = knot();\r\n\r\nclass Vnjson {\r\n    version = \"2.0.1\";\r\n    ctx = null;\r\n    tree = null;\r\n    package = null;\r\n    debug = false;\r\n    conf = null;\r\n    events = emitter.events;\r\n    plugins = {};\r\n    store = {};\r\n    state = {\r\n        index: 0,\r\n        labelName: \"\",\r\n        sceneName: \"\",\r\n        character: null,\r\n        data: {\r\n            score: null,\r\n        },\r\n        tree: [],\r\n        assets: [],\r\n    };\r\n    on = emitter.on;\r\n    once = emitter.once;\r\n    emit = emitter.emit;\r\n    off = emitter.off;\r\n    constructor() {}\r\n    getAssetByName(name) {\r\n        const asset = this.state.assets.find((asset) => {\r\n            return asset.name === name;\r\n        });\r\n        if (asset) {\r\n            return asset;\r\n        } else {\r\n            this.emit(\"error\", \"assetNotFound\", name);\r\n            return { url: name };\r\n        }\r\n    }\r\n    getDataByName(id) {\r\n        const scenesBody = Object.values(this.tree);\r\n        let data = null;\r\n        scenesBody.forEach((body) => {\r\n            if (body.data) {\r\n                if (body.data.hasOwnProperty(id)) {\r\n                    data = { id, body: decodeURI(atob(body.data[id])) };\r\n                }\r\n            }\r\n        });\r\n        return data;\r\n    }\r\n    isSceneExist(sceneName) {\r\n        if (this.tree[sceneName]) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    isLabelExist(sceneName, labelName) {\r\n        if (this.isSceneExist(sceneName) && this.tree[sceneName][labelName]) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    isRouteExist(pathname) {\r\n        const route = pathname.split(\".\");\r\n        if (route.length === 1) {\r\n            return this.isSceneExist(this.state.sceneName, route[0]);\r\n        }\r\n        if (route.length > 1) {\r\n            return this.isLabelExist(route[0], route[1]);\r\n        }\r\n    }\r\n    getCurrentLabelBody() {\r\n        try {\r\n            const labelBody =\r\n                this.tree[this.state.sceneName][this.state.labelName];\r\n            return labelBody;\r\n        } catch (err) {\r\n            this.emit(\"error\", \"menuOrJumpLeadsNowhere\");\r\n            return [\"\"];\r\n        }\r\n    }\r\n    getCurrentCharacter() {\r\n        return this.state.character;\r\n    }\r\n    getCharacterById(id) {\r\n        return this.tree.$root.characters.find(\r\n            (character) => character.id === id\r\n        );\r\n    }\r\n    getCharacters() {\r\n        return this.tree.$root.characters;\r\n    }\r\n\r\n    getCtx() {\r\n        return this.getCurrentLabelBody()[this.state.index];\r\n    }\r\n    mount(tree) {\r\n        this.tree = tree;\r\n        this.package = this.tree.$root.package;\r\n        if (!this.tree.$root.hasOwnProperty(\"characters\")) {\r\n            const narrator = {\r\n                id: \"$\",\r\n                name: \". . . .\",\r\n                nameColor: \"#49de58\",\r\n                replyColor: \"#a4deaa\",\r\n            };\r\n            if (this.conf.$) {\r\n                narrator = this.conf.$;\r\n            }\r\n            this.tree.$root.characters = [narrator];\r\n        }\r\n\r\n        this.tree.$root.characters.map((character) => {\r\n            /**\r\n             * Навешиваем слушатель на id персонажа\r\n             *\r\n             */\r\n            this.on(character.id, (reply) => {\r\n                this.state.character = character;\r\n                this.emit(\"vnjson.character\", character, reply);\r\n            });\r\n        });\r\n\r\n        this.emit(\"vnjson.mount\");\r\n    }\r\n    exec(ctx) {\r\n        //Получаем текущий объект контекста\r\n        this.ctx = ctx || this.getCtx();\r\n        if (typeof this.ctx === \"string\") {\r\n            this.emit(\"$\", this.ctx);\r\n            this.emit(\"exec\", this.ctx);\r\n        }\r\n        // $: null | $: false\r\n        else if (!this.ctx) {\r\n            this.emit(\"$\", String(this.ctx));\r\n            this.emit(\"exec\", String(this.ctx));\r\n        } else if (typeof this.ctx === \"object\") {\r\n            /**\r\n             * Преобразуем объект контекста [this.ctx] в массив\r\n             * [ ['key', 'value'], ['key2','value2']]\r\n             * Пробегаемся по этому массиву, и записываем\r\n             * ключ-значение в переменные [ event, data ]\r\n             */\r\n            for (let [event, data] of Object.entries(this.ctx)) {\r\n                /**\r\n                 * Вызываем плагины с соответсвующими именами ключей\r\n                 */\r\n                if (!/^_/i.test(event)) {\r\n                    this.emit(event, data);\r\n                }\r\n            }\r\n        } else {\r\n            this.emit(\"$\", String(this.ctx));\r\n        }\r\n        this.emit(\"vnjson.exec\", this.ctx);\r\n    }\r\n\r\n    next() {\r\n        if (this.getCurrentLabelBody().length - 2 < this.state.index) {\r\n            this.state.index = this.state.index;\r\n            this.emit(\"warn\", `NoWayOutOfTheLabel`);\r\n        } else {\r\n            this.state.index++;\r\n            this.exec();\r\n            this.emit(\"vnjson.next\");\r\n        }\r\n    }\r\n    use(plugin) {\r\n        plugin.call(this, this.tree);\r\n    }\r\n}\r\n\r\nexport default Vnjson;\r\n","export default function (){\r\n    console.log(...arguments)\r\n}\r\n","/**\r\n * jump: scene.label        # jump between scenes\r\n * jump: label              # jump inside the scene\r\n * jump: scene.label.7      # jump to index position\r\n * jump: _mark_1            # jump to a point inside the label\r\n */\r\nexport default function (_pathname) {\r\n    const pathname = String(_pathname);\r\n    /**\r\n     * Обработка прыжка по менткам _mark\r\n     */\r\n    if (/^_/i.test(pathname)) {\r\n        const labelBody = this.getCurrentLabelBody();\r\n        if (labelBody.length === 0) return;\r\n        const index = labelBody\r\n            .map((ctx) => {\r\n                return ctx.hasOwnProperty(pathname);\r\n            })\r\n            .indexOf(true);\r\n\r\n        const label = [this.state.sceneName, this.state.labelName, index].join(\r\n            \".\"\r\n        );\r\n\r\n        this.exec({ jump: label });\r\n    } else {\r\n        const path = pathname.split(\".\");\r\n        this.state.index = path[2] || 0;\r\n        //label\r\n        if (!/\\./i.test(pathname)) {\r\n            this.state.labelName = path[0];\r\n            this.emit(\"jump.init\", false);\r\n            this.exec();\r\n        }\r\n        //scene.label\r\n        if (/\\./i.test(pathname)) {\r\n            this.state.sceneName = path[0];\r\n            this.state.labelName = path[1];\r\n            this.emit(\"jump.init\", true);\r\n            this.exec();\r\n        }\r\n    }\r\n}\r\n","\r\n/**\r\n * - +: Append chunk to phrase\r\n */\r\nexport default function (reply) {\r\n              \r\n    if(!this.state.character) {\r\n        this.state.character = this.tree.$root.characters[0]\r\n    } \r\n    this.emit(\"vnjson.character\", this.state.character, reply, true);\r\n}","/**\r\n * timeout:\r\n *   timer: 1000\r\n *   exec: # deprecated\r\n *      $: Time is over\r\n *   onEnd:\r\n *      $: Time is over\r\n */\r\nexport default function (args) {\r\n    setTimeout(() => {\r\n        this.exec(args.onEnd || args.exec);\r\n    }, args.timer);\r\n}\r\n","\r\n/**\r\n * next: true\r\n */\r\nexport default function () {\r\n    setTimeout(() => this.next(), 50);\r\n}","import Vnjson from \"./Vnjson.js\";\r\n/**\r\n * native plugins\r\n */\r\nimport log from \"./plugins/log.js\";\r\nimport jump from \"./plugins/jump.js\";\r\nimport append from \"./plugins/append.js\";\r\nimport timeout from \"./plugins/timeout.js\";\r\nimport next from \"./plugins/next.js\";\r\n\r\nconst vnjs = new Vnjson();\r\n\r\n/**\r\n * init plugins\r\n */\r\nvnjs.on(\"log\", log);\r\nvnjs.on(\"jump\", jump);\r\nvnjs.on(\"+\", append);\r\nvnjs.on(\"timeout\", timeout);\r\nvnjs.on(\"next\", next);\r\n\r\n\r\nexport default vnjs;\r\n"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","knot","extended","undefined","events","create","on","name","handler","push","once","_once","off","splice","indexOf","emit","_this","_len","args","Array","_key","cache","slice","forEach","apply","emitter","Vnjson","version","ctx","tree","package","debug","conf","plugins","store","state","index","labelName","sceneName","character","data","score","assets","constructor","getAssetByName","asset","find","url","getDataByName","id","scenesBody","values","body","decodeURI","atob","isSceneExist","isLabelExist","isRouteExist","pathname","route","split","getCurrentLabelBody","labelBody","err","getCurrentCharacter","getCharacterById","$root","characters","getCharacters","getCtx","mount","narrator","nameColor","replyColor","$","map","reply","exec","String","event","entries","test","next","use","plugin","console","log","_pathname","label","join","jump","path","setTimeout","onEnd","timer","vnjs","append","timeout"],"mappings":"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"}